<!DOCTYPE html>

<html>
<head>
  <title>3-agentset.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="1-util.html">
                1-util.coffee
              </a>
            
              
              <a class="source" href="2-shapes.html">
                2-shapes.coffee
              </a>
            
              
              <a class="source" href="3-agentset.html">
                3-agentset.coffee
              </a>
            
              
              <a class="source" href="4-agentsets.html">
                4-agentsets.coffee
              </a>
            
              
              <a class="source" href="5-model.html">
                5-model.coffee
              </a>
            
              
              <a class="source" href="6-template.html">
                6-template.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>3-agentset.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>An <strong>AgentSet</strong> is an array, along with a class, agentClass, whose instances
are the items of the array.  Instances of the class are created
by the <code>create</code> factory method of an AgentSet.</p>
<p>It is a subclass of <code>Array</code> and is the base class for
<code>Patches</code>, <code>Agents</code>, and <code>Links</code>. An AgentSet keeps track of all
its created instances.  It also provides, much like the <strong>ABM.util</strong>
module, many methods shared by all subclasses of AgentSet.</p>
<p>ABM contains three agentsets created by class Model:</p>
<ul>
<li><code>ABM.patches</code>: the model’s “world” grid</li>
<li><code>ABM.agents</code>: the model’s agents living on the patchs</li>
<li><code>ABM.links</code>: the network links connecting agent pairs</li>
</ul>
<p>See NetLogo <a href="http://ccl.northwestern.edu/netlogo/docs/">documentation</a>
for explanation on the overall semantics of Agent Based Modeling
used by AgentSets as well as Patches, Agents, and Links.</p>
<p>Note: subclassing <code>Array</code> can be dangerous and we may have to convert
to a different style. See Trevor Burnham’s <a href="http://goo.gl/Lca8g">comments</a>
but thus far we’ve resolved all related problems.</p>
<p>Because we are an array subset, @[i] == this[i] == agentset[i]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ABM</span>.<span class="hljs-title">AgentSet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Array</span> </span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h3 id="static-members">Static members</h3>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><code>asSet</code> is a static wrapper function converting an array of agents into
an <code>AgentSet</code> .. except for the ID which only impacts the add method.
It is primarily used to turn a comprehension into an AgentSet instance
which then gains access to all the methods below.  Ex:</p>
<pre><code>evens = (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> ABM.agents <span class="hljs-keyword">when</span> a.id % <span class="hljs-number">2</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>)
ABM.AgentSet.asSet(evens)
randomEven = evens.oneOf()
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-property">@asSet</span>: <span class="hljs-function"><span class="hljs-params">(a, setType = ABM.AgentSet)</span> -&gt;</span>
    proto = setType.prototype ? setType.constructor.prototype <span class="hljs-comment"># setType.__proto__</span>
    <span class="hljs-keyword">if</span> Object.setPrototypeOf?
      a = Object.setPrototypeOf a, proto
    <span class="hljs-keyword">else</span>
      a.__proto__ = proto
      <span class="hljs-keyword">if</span> ABM.util.isEarlyIE()</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>IE 9/10 fix - copy object methods from the protype to the new object, since
<strong>proto</strong> doesn’t work.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> prop <span class="hljs-keyword">of</span> proto
          a[prop] = proto[prop]
    a</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>In the examples below, we’ll use an array of primitive agent objects
with three fields: id, x, y.</p>
<pre><code>AS = <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span><span class="hljs-number">.5</span>] <span class="hljs-comment"># long form comprehension</span>
  {<span class="hljs-attribute">id</span>:i, <span class="hljs-attribute">x</span>:u.randomInt(<span class="hljs-number">10</span>), <span class="hljs-attribute">y</span>:u.randomInt(<span class="hljs-number">10</span>)}
ABM.AgentSet.asSet AS <span class="hljs-comment"># Convert AS to AgentSet in place</span>
<span class="hljs-comment"># .. produced</span>
   [{<span class="hljs-attribute">id</span>:<span class="hljs-number">1</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">0</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">1</span>}, {<span class="hljs-attribute">id</span>:<span class="hljs-number">2</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">8</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">0</span>}, {<span class="hljs-attribute">id</span>:<span class="hljs-number">3</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">6</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">4</span>},
    {<span class="hljs-attribute">id</span>:<span class="hljs-number">4</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">1</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">3</span>}, {<span class="hljs-attribute">id</span>:<span class="hljs-number">5</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">1</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">1</span>}]
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3 id="constructor-and-add-remove-agents-">Constructor and add/remove agents.</h3>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Create an empty <code>AgentSet</code> and initialize the <code>ID</code> counter for add().
If mainSet is supplied, the new agentset is a sub-array of mainSet.
This sub-array feature is how breeds are managed, see class <code>Model</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@agentClass</span>, <span class="hljs-property">@name</span>, <span class="hljs-property">@mainSet</span>)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>()
    <span class="hljs-property">@agentClass</span>::breed = @ <span class="hljs-comment"># let the breed know I'm it's agentSet</span>
    <span class="hljs-property">@ownVariables</span> = []
    <span class="hljs-property">@ID</span> = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@mainSet</span>? <span class="hljs-comment"># Do not set ID if I'm a subset</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Abstract method used by subclasses to create and add their instances.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">create</span>:<span class="hljs-function"> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Add an agent to the list.  Only used by agentset factory methods. Adds
the <code>id</code> property to all agents. Increment <code>ID</code>.
Returns the object for chaining. The set will be sorted by <code>id</code>.</p>
<p>By “agent” we mean an instance of <code>Patch</code>, <code>Agent</code> and <code>Link</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">add</span>: <span class="hljs-function"><span class="hljs-params">(o)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@mainSet</span>? <span class="hljs-keyword">then</span> <span class="hljs-property">@mainSet</span>.add o <span class="hljs-keyword">else</span> o.id = <span class="hljs-property">@ID</span>++
    <span class="hljs-property">@push</span> o; o</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Remove an agent from the agentset, returning the agentset.
Note this does not change ID, thus an
agentset can have gaps in terms of their id’s. Assumes set is
sorted by <code>id</code>. If the set is one created by <code>asSet</code>, and the original
array is unsorted, simply call <code>sortById</code> first, see <code>sortById</code> below.</p>
<pre><code>AS.remove(AS[<span class="hljs-number">3</span>]) <span class="hljs-comment"># [{id:0,x:0,y:1}, {id:1,x:8,y:0},</span>
                    {<span class="hljs-attribute">id</span>:<span class="hljs-number">2</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">6</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">4</span>}, {<span class="hljs-attribute">id</span>:<span class="hljs-number">4</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">1</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">1</span>}] 
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">remove</span>: <span class="hljs-function"><span class="hljs-params">(o)</span> -&gt;</span>
    <span class="hljs-property">@mainSet</span>.remove o <span class="hljs-keyword">if</span> <span class="hljs-property">@mainSet</span>?
    u.error <span class="hljs-string">"remove: empty arraySet"</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@length</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">if</span> o <span class="hljs-keyword">is</span> <span class="hljs-property">@last</span>()
      @[--<span class="hljs-property">@length</span>] = <span class="hljs-literal">null</span> <span class="hljs-comment"># set last to null and decrease length (null: GC subtlety)</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@splice</span> i, <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> (i = <span class="hljs-property">@indexOfID</span> o.id) <span class="hljs-keyword">isnt</span> -<span class="hljs-number">1</span>
      u.error <span class="hljs-string">"remove: indexOfID not in list"</span> <span class="hljs-keyword">if</span> i <span class="hljs-keyword">is</span> -<span class="hljs-number">1</span>
    @

  <span class="hljs-attribute">setDefault</span>: <span class="hljs-function"><span class="hljs-params">(name, value)</span> -&gt;</span>
    u.error <span class="hljs-string">"setDefault: name is not a string"</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> name <span class="hljs-keyword">isnt</span> <span class="hljs-string">"string"</span>
    <span class="hljs-property">@agentClass</span>::[name] = value

  <span class="hljs-attribute">own</span>: <span class="hljs-function"><span class="hljs-params">(nameValueList...)</span> -&gt;</span>
    u.error <span class="hljs-string">"own: odd number of arguments"</span> <span class="hljs-keyword">if</span> nameValueList.length % <span class="hljs-number">2</span> <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> name, i <span class="hljs-keyword">in</span> nameValueList <span class="hljs-keyword">by</span> <span class="hljs-number">2</span>
      <span class="hljs-property">@setDefault</span> name, nameValueList[i+<span class="hljs-number">1</span>]
      <span class="hljs-property">@ownVariables</span>.push name</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Remove adjacent duplicates, by reference, in a sorted agentset.
Use <code>sortById</code> first if agentset not sorted.</p>
<pre><code>as = (AS.oneOf() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span><span class="hljs-number">.4</span>]) <span class="hljs-comment"># 4 random agents w/ dups</span>
ABM.AgentSet.asSet as <span class="hljs-comment"># [{id:1,x:8,y:0}, {id:0,x:0,y:1},</span>
                         {<span class="hljs-attribute">id</span>:<span class="hljs-number">0</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">0</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">1</span>}, {<span class="hljs-attribute">id</span>:<span class="hljs-number">2</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">6</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">4</span>}]
as.sortById().uniq() <span class="hljs-comment"># [{id:0,x:0,y:1}, {id:1,x:8,y:0}, </span>
                        {<span class="hljs-attribute">id</span>:<span class="hljs-number">2</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">6</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">4</span>}]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">uniq</span>:<span class="hljs-function"> -&gt;</span> u.uniq(@)</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Return the agent with the given <code>id</code> within the sorted agentset.
Uses binary search thus is faster than simple lookup.</p>
<pre><code>AS.withID <span class="hljs-number">4</span> <span class="hljs-comment"># {id:4,x:1,y:1}</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">withID</span>: <span class="hljs-function"><span class="hljs-params">(id)</span> -&gt;</span> <span class="hljs-comment"># null if not found</span>
    <span class="hljs-keyword">if</span> (i = <span class="hljs-property">@indexOfID</span>(id)) <span class="hljs-keyword">isnt</span> -<span class="hljs-number">1</span> <span class="hljs-keyword">then</span> @[i] <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Return the array index of the given agent id in the sorted set.
If agentset is not sorted, call @sortById() first.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">indexOfID</span>: <span class="hljs-function"><span class="hljs-params">(id, sorted=<span class="hljs-literal">true</span>)</span> -&gt;</span> <span class="hljs-comment"># -1 if not found</span>
    <span class="hljs-property">@sortById</span>() <span class="hljs-keyword">unless</span> sorted
    <span class="hljs-keyword">return</span> <span class="hljs-property">@length</span>-<span class="hljs-number">1</span> <span class="hljs-keyword">if</span> id <span class="hljs-keyword">is</span> <span class="hljs-property">@last</span>().id  <span class="hljs-comment"># no "die" calls yet</span>
    u.binarySearch @, id, <span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>o.id</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>The static <code>ABM.AgentSet.asSet</code> as a method.
Used by agentset methods creating new agentsets.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">asSet</span>: <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span> ABM.AgentSet.asSet a <span class="hljs-comment"># , @</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Similar to above but sorted via <code>id</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">asOrderedSet</span>: <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span> <span class="hljs-property">@asSet</span>(a).sortById()</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Return string representative of agentset.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-string">"["</span>+(a.toString() <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @).join(<span class="hljs-string">", "</span>)+<span class="hljs-string">"]"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h3 id="property-utilities">Property Utilities</h3>
<p>Property access, also useful for debugging<br></p>

            </div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Return an array of a property of the agentset</p>
<pre><code> AS.getProp <span class="hljs-string">"x"</span> <span class="hljs-comment"># [0, 8, 6, 1, 1]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">getProp</span>: <span class="hljs-function"><span class="hljs-params">(prop)</span> -&gt;</span> o[prop] <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Return an array of arrays of props, given as a string or an array of strings.</p>
<pre><code>AS.getProps <span class="hljs-string">"id x y"</span>
AS.getProps [<span class="hljs-string">"id"</span>, <span class="hljs-string">"x"</span>, <span class="hljs-string">"y"</span>]
[[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">5</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">getProps</span>: <span class="hljs-function"><span class="hljs-params">(props)</span> -&gt;</span> 
    props = props.split(<span class="hljs-string">" "</span>) <span class="hljs-keyword">if</span> u.isString props
    (o[p] <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> props) <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Return an array of agents with the property equal to the given value</p>
<pre><code>AS.getPropWith <span class="hljs-string">"x"</span>, <span class="hljs-number">1</span>
[{<span class="hljs-attribute">id</span>:<span class="hljs-number">4</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">1</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">3</span>},{<span class="hljs-attribute">id</span>:<span class="hljs-number">5</span>,<span class="hljs-attribute">x</span>:<span class="hljs-number">1</span>,<span class="hljs-attribute">y</span>:<span class="hljs-number">1</span>}]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">getPropWith</span>: <span class="hljs-function"><span class="hljs-params">(prop, value)</span> -&gt;</span> <span class="hljs-property">@asSet</span> (o <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> o[prop] <span class="hljs-keyword">is</span> value)</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Set the property of the agents to a given value</p>
<pre><code><span class="hljs-comment"># increment x for agents with x=1</span>
AS1 = ABM.AgentSet.asSet AS.getPropWith(<span class="hljs-string">"x"</span>,<span class="hljs-number">1</span>)
AS1.setProp <span class="hljs-string">"x"</span>, <span class="hljs-number">2</span> <span class="hljs-comment"># {id:4,x:2,y:3},{id:5,x:2,y:1}</span>
</code></pre><p>Note this changes the last two objects in the original AS above</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">setProp</span>: <span class="hljs-function"><span class="hljs-params">(prop, value)</span> -&gt;</span> o[prop] = value <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @; @</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Get the agent with the min/max prop value in the agentset</p>
<pre><code>min = AS.minProp <span class="hljs-string">"y"</span>  <span class="hljs-comment"># 0</span>
max = AS.maxProp <span class="hljs-string">"y"</span>  <span class="hljs-comment"># 4</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">maxProp</span>: <span class="hljs-function"><span class="hljs-params">(prop)</span> -&gt;</span> Math.max <span class="hljs-property">@getProp</span>(prop)...
  <span class="hljs-attribute">minProp</span>: <span class="hljs-function"><span class="hljs-params">(prop)</span> -&gt;</span> Math.min <span class="hljs-property">@getProp</span>(prop)...</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h3 id="array-utilities-often-from-abm-util">Array Utilities, often from ABM.util</h3>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Randomize the agentset</p>
<pre><code>AS.shuffle(); AS.getProp <span class="hljs-string">"id"</span> <span class="hljs-comment"># [3, 2, 1, 4, 5] </span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">shuffle</span>:<span class="hljs-function"> -&gt;</span> u.shuffle @</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Sort the agentset by the agent’s <code>id</code>.</p>
<pre><code>AS.shuffle();  AS.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [3, 2, 1, 4, 5] </span>
AS.sortById(); AS.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [1, 2, 3, 4, 5]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">sortById</span>:<span class="hljs-function"> -&gt;</span> u.sortBy @, <span class="hljs-string">"id"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Make a copy of an agentset, return as new agentset.<br>
NOTE: does <em>not</em> duplicate the objects, simply creates a new agentset
with references to the same agents.  Ex: create a randomized version of AS
but without mangling AS itself:</p>
<pre><code>as = AS.clone().shuffle()
AS.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [1, 2, 3, 4, 5]</span>
as.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [2, 4, 0, 1, 3]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">clone</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@asSet</span> u.clone @</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Return the last agent in the agentset</p>
<pre><code>AS.last().id             <span class="hljs-comment"># l5</span>
l=AS.last(); p=[l.x,l.y] <span class="hljs-comment"># [1,1]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">last</span>:<span class="hljs-function"> -&gt;</span> u.last @</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Returns true if the agentset has any agents</p>
<pre><code>AS.any()  <span class="hljs-comment"># true</span>
AS.getPropWith(<span class="hljs-string">"x"</span>, <span class="hljs-number">99</span>).any() <span class="hljs-comment">#false</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">any</span>:<span class="hljs-function"> -&gt;</span> u.any @</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Return an agentset without given agent a</p>
<pre><code>as = AS.clone().other(AS[<span class="hljs-number">0</span>])
as.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [1, 2, 3, 4] </span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">other</span>: <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span> <span class="hljs-property">@asSet</span> (o <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> o <span class="hljs-keyword">isnt</span> a) <span class="hljs-comment"># could clone &amp; remove</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Return random agent in agentset</p>
<pre><code>AS.oneOf()  <span class="hljs-comment"># {id:2,x:6,y:4}</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">oneOf</span>:<span class="hljs-function"> -&gt;</span> u.oneOf @</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Return agentset made of n distinct agents</p>
<pre><code>AS.nOf(<span class="hljs-number">3</span>) <span class="hljs-comment"># [{id:0,x:0,y:1}, {id:4,x:1,y:1}, {id:1,x:8,y:0}]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">nOf</span>: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span> <span class="hljs-property">@asSet</span> u.nOf @, n</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Return agent when f(o) min/max in agentset. If multiple agents have
min/max value, return the first. Error if agentset empty.
If f is a string, return element with min/max value of that property.
If “valueToo” then return an array of the agent and the value.</p>
<pre><code>AS.minOneOf(<span class="hljs-string">"x"</span>) <span class="hljs-comment"># {id:0,x:0,y:1}</span>
AS.maxOneOf<span class="hljs-function"><span class="hljs-params">((a)-&gt;a.x+a.y, <span class="hljs-literal">true</span>)</span> # {<span class="hljs-title">id</span>:2,<span class="hljs-title">x</span>:6,<span class="hljs-title">y</span>:4},10 </span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">minOneOf</span>: <span class="hljs-function"><span class="hljs-params">(f, valueToo=<span class="hljs-literal">false</span>)</span> -&gt;</span>
    u.minOneOf @, f, valueToo
  <span class="hljs-attribute">maxOneOf</span>: <span class="hljs-function"><span class="hljs-params">(f, valueToo=<span class="hljs-literal">false</span>)</span> -&gt;</span>
    u.maxOneOf @, f, valueToo</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h3 id="drawing">Drawing</h3>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>For agentsets who’s agents have a <code>draw</code> method.
Clears the graphics context (transparent), then
calls each agent’s draw(ctx) method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">draw</span>: <span class="hljs-function"><span class="hljs-params">(ctx)</span> -&gt;</span>
    u.clearCtx(ctx)
    o.draw(ctx) <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> <span class="hljs-keyword">not</span> o.hidden; <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h3 id="topology">Topology</h3>

            </div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>For ABM.patches &amp; ABM.agents which have x,y. See ABM.util doc.</p>
<p>Return all agents in agentset within d distance from given object.
By default excludes the given object. Uses linear/torus distance
depending on patches.isTorus, and patches width/height if needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">inRadius</span>: <span class="hljs-function"><span class="hljs-params">(o, d, meToo=<span class="hljs-literal">false</span>)</span> -&gt;</span> <span class="hljs-comment"># for any objects w/ x,y</span>
    d2 = d*d; x=o.x; y=o.y
    <span class="hljs-keyword">if</span> ABM.patches.isTorus
      w=ABM.patches.numX; h=ABM.patches.numY
      <span class="hljs-property">@asSet</span> (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> \
        u.torusSqDistance(x,y,a.x,a.y,w,h)&lt;=d2 <span class="hljs-keyword">and</span> (meToo <span class="hljs-keyword">or</span> a <span class="hljs-keyword">isnt</span> o))
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@asSet</span> (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> \
        u.sqDistance(x,y,a.x,a.y)&lt;=d2 <span class="hljs-keyword">and</span> (meToo <span class="hljs-keyword">or</span> a <span class="hljs-keyword">isnt</span> o))</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>As above, but also limited to the angle <code>cone</code> around
a <code>heading</code> from object <code>o</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">inCone</span>: <span class="hljs-function"><span class="hljs-params">(o, heading, cone, radius, meToo=<span class="hljs-literal">false</span>)</span> -&gt;</span>
    rSet = <span class="hljs-property">@inRadius</span> o, radius, meToo
    x=o.x; y=o.y
    <span class="hljs-keyword">if</span> ABM.patches.isTorus
      w=ABM.patches.numX; h=ABM.patches.numY
      <span class="hljs-property">@asSet</span> (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> rSet <span class="hljs-keyword">when</span> \
        (a <span class="hljs-keyword">is</span> o <span class="hljs-keyword">and</span> meToo) <span class="hljs-keyword">or</span> u.inTorusCone(heading,cone,radius,x,y,a.x,a.y,w,h))
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@asSet</span> (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> rSet <span class="hljs-keyword">when</span> \
        (a <span class="hljs-keyword">is</span> o <span class="hljs-keyword">and</span> meToo) <span class="hljs-keyword">or</span> u.inCone(heading,cone,radius,x,y,a.x,a.y))</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h3 id="debugging">Debugging</h3>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Useful in console.
Also see <a href="http://goo.gl/1i7bd">CoffeeConsole</a> Chrome extension.</p>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Similar to NetLogo ask &amp; with operators.
Allows functions as strings. Use:</p>
<pre><code>AS.getProp(<span class="hljs-string">"x"</span>) <span class="hljs-comment"># [1, 8, 6, 2, 2]</span>
AS.<span class="hljs-reserved">with</span>(<span class="hljs-string">"o.x&lt;5"</span>).ask(<span class="hljs-string">"o.x=o.x+1"</span>)
AS.getProp(<span class="hljs-string">"x"</span>) <span class="hljs-comment"># [2, 8, 6, 3, 3]</span>

ABM.agents.<span class="hljs-reserved">with</span>(<span class="hljs-string">"o.id&lt;100"</span>).ask(<span class="hljs-string">"o.color=[255,0,0]"</span>)
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">ask</span>: <span class="hljs-function"><span class="hljs-params">(f)</span> -&gt;</span> 
    eval(<span class="hljs-string">"f=function(o){return "</span>+f+<span class="hljs-string">";}"</span>) <span class="hljs-keyword">if</span> u.isString f
    f(o) <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @; @
  <span class="hljs-attribute">with</span>: <span class="hljs-function"><span class="hljs-params">(f)</span> -&gt;</span> 
    eval(<span class="hljs-string">"f=function(o){return "</span>+f+<span class="hljs-string">";}"</span>) <span class="hljs-keyword">if</span> u.isString f
    <span class="hljs-property">@asSet</span> (o <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> f(o))</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>The example agentset AS used in the code fragments was made like this,
slightly more useful than shown above due to the toString method.</p>
<pre><code><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XY</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@x</span>,<span class="hljs-property">@y</span>)</span> -&gt;</span>
  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-string">"{id:<span class="hljs-subst">#{<span class="hljs-property">@id</span>}</span>,x:<span class="hljs-subst">#{<span class="hljs-property">@x</span>}</span>,y:<span class="hljs-subst">#{<span class="hljs-property">@y</span>}</span>}"</span>
<span class="hljs-property">@AS</span> = <span class="hljs-keyword">new</span> ABM.AgentSet <span class="hljs-comment"># @ =&gt; global name space</span>
</code></pre><p>The result of </p>
<pre><code>AS.add <span class="hljs-keyword">new</span> XY(u.randomInt(<span class="hljs-number">10</span>), u.randomInt(<span class="hljs-number">10</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span><span class="hljs-number">.5</span>]
</code></pre><p>random run, captured so we can reuse.</p>
<pre><code>AS.add <span class="hljs-keyword">new</span> XY(pt...) <span class="hljs-keyword">for</span> pt <span class="hljs-keyword">in</span> [[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">8</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">6</span>,<span class="hljs-number">4</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]]
</code></pre>
            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
