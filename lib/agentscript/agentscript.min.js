!function(t){"use strict";function e(t){switch(typeof t){case"undefined":return"undefined";case"boolean":return"boolean";case"number":return"number";case"string":return"string";default:return null===t?"null":"object"}}function r(t){return Object.prototype.toString.call(t).replace(/^\[object *|\]$/g,"")}function n(t){return"function"==typeof t}function i(t){if(null===t||t===O)throw TypeError();return Object(t)}function o(t){return t>>0}function s(t){return t>>>0}function a(t){function e(e){Object.defineProperty(t,e,{get:function(){return t._getter(e)},set:function(r){t._setter(e,r)},enumerable:!0,configurable:!1})}if(t.length>T)throw RangeError("Array too large for polyfill");var r;for(r=0;r<t.length;r+=1)e(r)}function u(t,e){var r=32-e;return t<<r>>r}function h(t,e){var r=32-e;return t<<r>>>r}function l(t){return[255&t]}function c(t){return u(t[0],8)}function p(t){return[255&t]}function f(t){return h(t[0],8)}function y(t){return t=D(Number(t)),[0>t?0:t>255?255:255&t]}function d(t){return[t>>8&255,255&t]}function g(t){return u(t[0]<<8|t[1],16)}function m(t){return[t>>8&255,255&t]}function v(t){return h(t[0]<<8|t[1],16)}function x(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]}function w(t){return u(t[0]<<24|t[1]<<16|t[2]<<8|t[3],32)}function b(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]}function A(t){return h(t[0]<<24|t[1]<<16|t[2]<<8|t[3],32)}function _(t,e,r){function n(t){var e=j(t),r=t-e;return.5>r?e:r>.5?e+1:e%2?e+1:e}var i,o,s,a,u,h,l,c=(1<<e-1)-1;for(t!==t?(o=(1<<e)-1,s=Y(2,r-1),i=0):1/0===t||t===-1/0?(o=(1<<e)-1,s=0,i=0>t?1:0):0===t?(o=0,s=0,i=1/t===-1/0?1:0):(i=0>t,t=C(t),t>=Y(2,1-c)?(o=k(j(R(t)/I),1023),s=n(t/Y(2,o)*Y(2,r)),s/Y(2,r)>=2&&(o+=1,s=1),o>c?(o=(1<<e)-1,s=0):(o+=c,s-=Y(2,r))):(o=0,s=n(t/Y(2,1-c-r)))),u=[],a=r;a;a-=1)u.push(s%2?1:0),s=j(s/2);for(a=e;a;a-=1)u.push(o%2?1:0),o=j(o/2);for(u.push(i?1:0),u.reverse(),h=u.join(""),l=[];h.length;)l.push(parseInt(h.substring(0,8),2)),h=h.substring(8);return l}function M(t,e,r){var n,i,o,s,a,u,h,l,c=[];for(n=t.length;n;n-=1)for(o=t[n-1],i=8;i;i-=1)c.push(o%2?1:0),o>>=1;return c.reverse(),s=c.join(""),a=(1<<e-1)-1,u=parseInt(s.substring(0,1),2)?-1:1,h=parseInt(s.substring(1,1+e),2),l=parseInt(s.substring(1+e),2),h===(1<<e)-1?0!==l?0/0:1/0*u:h>0?u*Y(2,h-a)*(1+l/Y(2,r)):0!==l?u*Y(2,-(a-1))*(l/Y(2,r)):0>u?-0:0}function P(t){return M(t,11,52)}function S(t){return _(t,11,52)}function E(t){return M(t,8,23)}function B(t){return _(t,8,23)}var O=void 0,T=1e5,I=Math.LN2,C=Math.abs,j=Math.floor,R=Math.log,L=Math.max,k=Math.min,Y=Math.pow,D=Math.round;!function(){var t=Object.defineProperty,e=!function(){try{return Object.defineProperty({},"x",{})}catch(t){return!1}}();(!t||e)&&(Object.defineProperty=function(e,r,n){if(t)try{return t(e,r,n)}catch(i){}if(e!==Object(e))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in n&&Object.prototype.__defineGetter__.call(e,r,n.get),Object.prototype.__defineSetter__&&"set"in n&&Object.prototype.__defineSetter__.call(e,r,n.set),"value"in n&&(e[r]=n.value),e})}(),function(){function u(t){if(t=o(t),0>t)throw RangeError("ArrayBuffer size is not a small enough positive integer.");Object.defineProperty(this,"byteLength",{value:t}),Object.defineProperty(this,"_bytes",{value:Array(t)});for(var e=0;t>e;e+=1)this._bytes[e]=0}function h(){if(!arguments.length||"object"!=typeof arguments[0])return function(t){if(t=o(t),0>t)throw RangeError("length is not a small enough positive integer.");Object.defineProperty(this,"length",{value:t}),Object.defineProperty(this,"byteLength",{value:t*this.BYTES_PER_ELEMENT}),Object.defineProperty(this,"buffer",{value:new u(this.byteLength)}),Object.defineProperty(this,"byteOffset",{value:0})}.apply(this,arguments);if(arguments.length>=1&&"object"===e(arguments[0])&&arguments[0]instanceof h)return function(t){if(this.constructor!==t.constructor)throw TypeError();var e=t.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new u(e)}),Object.defineProperty(this,"byteLength",{value:e}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:t.length});for(var r=0;r<this.length;r+=1)this._setter(r,t._getter(r))}.apply(this,arguments);if(arguments.length>=1&&"object"===e(arguments[0])&&!(arguments[0]instanceof h)&&!(arguments[0]instanceof u||"ArrayBuffer"===r(arguments[0])))return function(t){var e=t.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new u(e)}),Object.defineProperty(this,"byteLength",{value:e}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:t.length});for(var r=0;r<this.length;r+=1){var n=t[r];this._setter(r,Number(n))}}.apply(this,arguments);if(arguments.length>=1&&"object"===e(arguments[0])&&(arguments[0]instanceof u||"ArrayBuffer"===r(arguments[0])))return function(t,e,r){if(e=s(e),e>t.byteLength)throw RangeError("byteOffset out of range");if(e%this.BYTES_PER_ELEMENT)throw RangeError("buffer length minus the byteOffset is not a multiple of the element size.");if(r===O){var n=t.byteLength-e;if(n%this.BYTES_PER_ELEMENT)throw RangeError("length of buffer minus byteOffset not a multiple of the element size");r=n/this.BYTES_PER_ELEMENT}else r=s(r),n=r*this.BYTES_PER_ELEMENT;if(e+n>t.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:t}),Object.defineProperty(this,"byteLength",{value:n}),Object.defineProperty(this,"byteOffset",{value:e}),Object.defineProperty(this,"length",{value:r})}.apply(this,arguments);throw TypeError()}function _(t,e,r){var n=function(){Object.defineProperty(this,"constructor",{value:n}),h.apply(this,arguments),a(this)};"__proto__"in n?n.__proto__=h:(n.from=h.from,n.of=h.of),n.BYTES_PER_ELEMENT=t;var i=function(){};return i.prototype=M,n.prototype=new i,Object.defineProperty(n.prototype,"BYTES_PER_ELEMENT",{value:t}),Object.defineProperty(n.prototype,"_pack",{value:e}),Object.defineProperty(n.prototype,"_unpack",{value:r}),n}t.ArrayBuffer=t.ArrayBuffer||u,Object.defineProperty(h,"from",{value:function(t){return new this(t)}}),Object.defineProperty(h,"of",{value:function(){return new this(arguments)}});var M={};h.prototype=M,Object.defineProperty(h.prototype,"_getter",{value:function(t){if(arguments.length<1)throw SyntaxError("Not enough arguments");if(t=s(t),t>=this.length)return O;var e,r,n=[];for(e=0,r=this.byteOffset+t*this.BYTES_PER_ELEMENT;e<this.BYTES_PER_ELEMENT;e+=1,r+=1)n.push(this.buffer._bytes[r]);return this._unpack(n)}}),Object.defineProperty(h.prototype,"get",{value:h.prototype._getter}),Object.defineProperty(h.prototype,"_setter",{value:function(t,e){if(arguments.length<2)throw SyntaxError("Not enough arguments");if(t=s(t),!(t>=this.length)){var r,n,i=this._pack(e);for(r=0,n=this.byteOffset+t*this.BYTES_PER_ELEMENT;r<this.BYTES_PER_ELEMENT;r+=1,n+=1)this.buffer._bytes[n]=i[r]}}}),Object.defineProperty(h.prototype,"constructor",{value:h}),Object.defineProperty(h.prototype,"copyWithin",{value:function(t,e){var r=arguments[2],n=i(this),a=n.length,u=s(a);u=L(u,0);var h,l=o(t);h=0>l?L(u+l,0):k(l,u);var c,p=o(e);c=0>p?L(u+p,0):k(p,u);var f;f=r===O?u:o(r);var y;y=0>f?L(u+f,0):k(f,u);var d,g=k(y-c,u-h);for(h>c&&c+g>h?(d=-1,c=c+g-1,h=h+g-1):d=1;g>0;)n._setter(h,n._getter(c)),c+=d,h+=d,g-=1;return n}}),Object.defineProperty(h.prototype,"every",{value:function(t){if(this===O||null===this)throw TypeError();var e=Object(this),r=s(e.length);if(!n(t))throw TypeError();for(var i=arguments[1],o=0;r>o;o++)if(!t.call(i,e._getter(o),o,e))return!1;return!0}}),Object.defineProperty(h.prototype,"fill",{value:function(t){var e=arguments[1],r=arguments[2],n=i(this),a=n.length,u=s(a);u=L(u,0);var h,l=o(e);h=0>l?L(u+l,0):k(l,u);var c;c=r===O?u:o(r);var p;for(p=0>c?L(u+c,0):k(c,u);p>h;)n._setter(h,t),h+=1;return n}}),Object.defineProperty(h.prototype,"filter",{value:function(t){if(this===O||null===this)throw TypeError();var e=Object(this),r=s(e.length);if(!n(t))throw TypeError();for(var i=[],o=arguments[1],a=0;r>a;a++){var u=e._getter(a);t.call(o,u,a,e)&&i.push(u)}return new this.constructor(i)}}),Object.defineProperty(h.prototype,"find",{value:function(t){var e=i(this),r=e.length,o=s(r);if(!n(t))throw TypeError();for(var a=arguments.length>1?arguments[1]:O,u=0;o>u;){var h=e._getter(u),l=t.call(a,h,u,e);if(Boolean(l))return h;++u}return O}}),Object.defineProperty(h.prototype,"findIndex",{value:function(t){var e=i(this),r=e.length,o=s(r);if(!n(t))throw TypeError();for(var a=arguments.length>1?arguments[1]:O,u=0;o>u;){var h=e._getter(u),l=t.call(a,h,u,e);if(Boolean(l))return u;++u}return-1}}),Object.defineProperty(h.prototype,"forEach",{value:function(t){if(this===O||null===this)throw TypeError();var e=Object(this),r=s(e.length);if(!n(t))throw TypeError();for(var i=arguments[1],o=0;r>o;o++)t.call(i,e._getter(o),o,e)}}),Object.defineProperty(h.prototype,"indexOf",{value:function(t){if(this===O||null===this)throw TypeError();var e=Object(this),r=s(e.length);if(0===r)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*j(C(n)))),n>=r)return-1;for(var i=n>=0?n:L(r-C(n),0);r>i;i++)if(e._getter(i)===t)return i;return-1}}),Object.defineProperty(h.prototype,"join",{value:function(t){if(this===O||null===this)throw TypeError();for(var e=Object(this),r=s(e.length),n=Array(r),i=0;r>i;++i)n[i]=e._getter(i);return n.join(t===O?",":t)}}),Object.defineProperty(h.prototype,"lastIndexOf",{value:function(t){if(this===O||null===this)throw TypeError();var e=Object(this),r=s(e.length);if(0===r)return-1;var n=r;arguments.length>1&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*j(C(n))));for(var i=n>=0?k(n,r-1):r-C(n);i>=0;i--)if(e._getter(i)===t)return i;return-1}}),Object.defineProperty(h.prototype,"map",{value:function(t){if(this===O||null===this)throw TypeError();var e=Object(this),r=s(e.length);if(!n(t))throw TypeError();var i=[];i.length=r;for(var o=arguments[1],a=0;r>a;a++)i[a]=t.call(o,e._getter(a),a,e);return new this.constructor(i)}}),Object.defineProperty(h.prototype,"reduce",{value:function(t){if(this===O||null===this)throw TypeError();var e=Object(this),r=s(e.length);if(!n(t))throw TypeError();if(0===r&&1===arguments.length)throw TypeError();var i,o=0;for(i=arguments.length>=2?arguments[1]:e._getter(o++);r>o;)i=t.call(O,i,e._getter(o),o,e),o++;return i}}),Object.defineProperty(h.prototype,"reduceRight",{value:function(t){if(this===O||null===this)throw TypeError();var e=Object(this),r=s(e.length);if(!n(t))throw TypeError();if(0===r&&1===arguments.length)throw TypeError();var i,o=r-1;for(i=arguments.length>=2?arguments[1]:e._getter(o--);o>=0;)i=t.call(O,i,e._getter(o),o,e),o--;return i}}),Object.defineProperty(h.prototype,"reverse",{value:function(){if(this===O||null===this)throw TypeError();for(var t=Object(this),e=s(t.length),r=j(e/2),n=0,i=e-1;r>n;++n,--i){var o=t._getter(n);t._setter(n,t._getter(i)),t._setter(i,o)}return t}}),Object.defineProperty(h.prototype,"set",{value:function(){if(arguments.length<1)throw SyntaxError("Not enough arguments");var t,e,r,n,i,o,a,u,h,l;if("object"==typeof arguments[0]&&arguments[0].constructor===this.constructor){if(t=arguments[0],r=s(arguments[1]),r+t.length>this.length)throw RangeError("Offset plus length of array is out of range");if(u=this.byteOffset+r*this.BYTES_PER_ELEMENT,h=t.length*this.BYTES_PER_ELEMENT,t.buffer===this.buffer){for(l=[],i=0,o=t.byteOffset;h>i;i+=1,o+=1)l[i]=t.buffer._bytes[o];for(i=0,a=u;h>i;i+=1,a+=1)this.buffer._bytes[a]=l[i]}else for(i=0,o=t.byteOffset,a=u;h>i;i+=1,o+=1,a+=1)this.buffer._bytes[a]=t.buffer._bytes[o]}else{if("object"!=typeof arguments[0]||"undefined"==typeof arguments[0].length)throw TypeError("Unexpected argument type(s)");if(e=arguments[0],n=s(e.length),r=s(arguments[1]),r+n>this.length)throw RangeError("Offset plus length of array is out of range");for(i=0;n>i;i+=1)o=e[i],this._setter(r+i,Number(o))}}}),Object.defineProperty(h.prototype,"slice",{value:function(t,e){for(var r=i(this),n=r.length,a=s(n),u=o(t),h=0>u?L(a+u,0):k(u,a),l=e===O?a:o(e),c=0>l?L(a+l,0):k(l,a),p=c-h,f=r.constructor,y=new f(p),d=0;c>h;){var g=r._getter(h);y._setter(d,g),++h,++d}return y}}),Object.defineProperty(h.prototype,"some",{value:function(t){if(this===O||null===this)throw TypeError();var e=Object(this),r=s(e.length);if(!n(t))throw TypeError();for(var i=arguments[1],o=0;r>o;o++)if(t.call(i,e._getter(o),o,e))return!0;return!1}}),Object.defineProperty(h.prototype,"sort",{value:function(t){if(this===O||null===this)throw TypeError();for(var e=Object(this),r=s(e.length),n=Array(r),i=0;r>i;++i)n[i]=e._getter(i);for(t?n.sort(t):n.sort(),i=0;r>i;++i)e._setter(i,n[i]);return e}}),Object.defineProperty(h.prototype,"subarray",{value:function(t,e){function r(t,e,r){return e>t?e:t>r?r:t}t=o(t),e=o(e),arguments.length<1&&(t=0),arguments.length<2&&(e=this.length),0>t&&(t=this.length+t),0>e&&(e=this.length+e),t=r(t,0,this.length),e=r(e,0,this.length);var n=e-t;return 0>n&&(n=0),new this.constructor(this.buffer,this.byteOffset+t*this.BYTES_PER_ELEMENT,n)}});var T=_(1,l,c),I=_(1,p,f),R=_(1,y,f),Y=_(2,d,g),D=_(2,m,v),X=_(4,x,w),F=_(4,b,A),N=_(4,B,E),z=_(8,S,P);t.Int8Array=t.Int8Array||T,t.Uint8Array=t.Uint8Array||I,t.Uint8ClampedArray=t.Uint8ClampedArray||R,t.Int16Array=t.Int16Array||Y,t.Uint16Array=t.Uint16Array||D,t.Int32Array=t.Int32Array||X,t.Uint32Array=t.Uint32Array||F,t.Float32Array=t.Float32Array||N,t.Float64Array=t.Float64Array||z}(),function(){function e(t,e){return n(t.get)?t.get(e):t[e]}function i(t,e,n){if(!(t instanceof ArrayBuffer||"ArrayBuffer"===r(t)))throw TypeError();if(e=s(e),e>t.byteLength)throw RangeError("byteOffset out of range");if(n=n===O?t.byteLength-e:s(n),e+n>t.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:t}),Object.defineProperty(this,"byteLength",{value:n}),Object.defineProperty(this,"byteOffset",{value:e})}function o(t){return function(r,n){if(r=s(r),r+t.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");r+=this.byteOffset;for(var i=new Uint8Array(this.buffer,r,t.BYTES_PER_ELEMENT),o=[],a=0;a<t.BYTES_PER_ELEMENT;a+=1)o.push(e(i,a));return Boolean(n)===Boolean(u)&&o.reverse(),e(new t(new Uint8Array(o).buffer),0)}}function a(t){return function(r,n,i){if(r=s(r),r+t.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");var o,a,h=new t([n]),l=new Uint8Array(h.buffer),c=[];for(o=0;o<t.BYTES_PER_ELEMENT;o+=1)c.push(e(l,o));Boolean(i)===Boolean(u)&&c.reverse(),a=new Uint8Array(this.buffer,r,t.BYTES_PER_ELEMENT),a.set(c)}}var u=function(){var t=new Uint16Array([4660]),r=new Uint8Array(t.buffer);return 18===e(r,0)}();Object.defineProperty(i.prototype,"getUint8",{value:o(Uint8Array)}),Object.defineProperty(i.prototype,"getInt8",{value:o(Int8Array)}),Object.defineProperty(i.prototype,"getUint16",{value:o(Uint16Array)}),Object.defineProperty(i.prototype,"getInt16",{value:o(Int16Array)}),Object.defineProperty(i.prototype,"getUint32",{value:o(Uint32Array)}),Object.defineProperty(i.prototype,"getInt32",{value:o(Int32Array)}),Object.defineProperty(i.prototype,"getFloat32",{value:o(Float32Array)}),Object.defineProperty(i.prototype,"getFloat64",{value:o(Float64Array)}),Object.defineProperty(i.prototype,"setUint8",{value:a(Uint8Array)}),Object.defineProperty(i.prototype,"setInt8",{value:a(Int8Array)}),Object.defineProperty(i.prototype,"setUint16",{value:a(Uint16Array)}),Object.defineProperty(i.prototype,"setInt16",{value:a(Int16Array)}),Object.defineProperty(i.prototype,"setUint32",{value:a(Uint32Array)}),Object.defineProperty(i.prototype,"setInt32",{value:a(Int32Array)}),Object.defineProperty(i.prototype,"setFloat32",{value:a(Float32Array)}),Object.defineProperty(i.prototype,"setFloat64",{value:a(Float64Array)}),t.DataView=t.DataView||i}()}(this),function(){var root,u,_base,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},__slice=[].slice,__extends=function(t,e){function r(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},__bind=function(t,e){return function(){return t.apply(e,arguments)}};this.ABM={},root=this,function(){var t,e,r,n;for(this.requestAnimFrame=this.requestAnimationFrame||null,this.cancelAnimFrame=this.cancelAnimationFrame||null,n=["ms","moz","webkit","o"],e=0,r=n.length;r>e;e++)t=n[e],this.requestAnimFrame||(this.requestAnimFrame||(this.requestAnimFrame=this[t+"RequestAnimationFrame"]),this.cancelAnimFrame||(this.cancelAnimFrame=this[t+"CancelAnimationFrame"]),this.cancelAnimFrame||(this.cancelAnimFrame=this[t+"CancelRequestAnimationFrame"]));return this.requestAnimFrame||(this.requestAnimFrame=function(t){return this.setTimeout(t,1e3/60)}),this.cancelAnimFrame||(this.cancelAnimFrame=function(t){return this.clearTimeout(t)})}(),(_base=Array.prototype).indexOf||(_base.indexOf=function(t){var e,r;return function(){var n,i,o;for(o=[],e=n=0,i=this.length;i>n;e=++n)r=this[e],o.push(r===t);return o}.call(this)?e:-1}),ABM.util=u={error:function(t){throw new Error(t)},isArray:Array.isArray||function(t){return!(!(t&&t.concat&&t.unshift)||t.callee)},isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},isString:function(t){return!!(""===t||t&&t.charCodeAt&&t.substr)},randomInt:function(t){return Math.floor(Math.random()*t)},randomInt2:function(t,e){return t+Math.floor(Math.random()*(e-t))},randomNormal:function(t,e){var r,n,i;return null==t&&(t=0),null==e&&(e=1),n=1-Math.random(),i=Math.random(),r=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*i),r*e+t},randomFloat:function(t){return Math.random()*t},randomFloat2:function(t,e){return t+Math.random()*(e-t)},randomCentered:function(t){return this.randomFloat2(-t/2,t/2)},log10:function(t){return Math.log(t)/Math.LN10},logN:function(t,e){return Math.log(t)/Math.log(e)},mod:function(t,e){return(t%e+e)%e},wrap:function(t,e,r){return e+this.mod(t-e,r-e)},clamp:function(t,e,r){return Math.max(Math.min(t,r),e)},sign:function(t){return 0>t?-1:1},aToFixed:function(t,e){var r,n,i,o;for(null==e&&(e=2),o=[],n=0,i=t.length;i>n;n++)r=t[n],o.push(r.toFixed(e));return o},randomColor:function(t){var e,r;for(null==t&&(t=[]),null!=t.str&&(t.str=null),e=r=0;2>=r;e=++r)t[e]=this.randomInt(256);return t},randomGray:function(t,e,r){var n,i,o;if(null==t&&(t=[]),null==e&&(e=64),null==r&&(r=192),2===arguments.length)return this.randomGray(null,t,e);for(null!=t.str&&(t.str=null),i=this.randomInt2(e,r),n=o=0;2>=o;n=++o)t[n]=i;return t},randomMapColor:function(t,e){return null==t&&(t=[]),null==e&&(e=[0,63,127,191,255]),this.setColor(t,u.oneOf(e),u.oneOf(e),u.oneOf(e))},randomBrightColor:function(t){return null==t&&(t=[]),this.randomMapColor(t,[0,127,255])},setColor:function(t,e,r,n,i){return null!=t.str&&(t.str=null),t[0]=e,t[1]=r,t[2]=n,null!=i&&(t[3]=i),t},scaleColor:function(t,e,r){var n,i,o,s;for(null==r&&(r=[]),null!=r.str&&(r.str=null),n=o=0,s=t.length;s>o;n=++o)i=t[n],r[n]=this.clamp(Math.round(i*e),0,255);return r},colorStr:function(t){var e;return null!=(e=t.str)?e:t.str=3===t.length?"rgb("+t+")":"rgba("+t+")"},colorsEqual:function(t,e){return t.toString()===e.toString()},isLittleEndian:function(){var t,e;return e=new Uint8ClampedArray(4),t=new Uint32Array(e.buffer),t[0]=16909060,4===e[0]},degToRad:function(t){return t*Math.PI/180},radToDeg:function(t){return 180*t/Math.PI},subtractRads:function(t,e){var r,n;return n=t-e,r=Math.PI,-r>=n&&(n+=2*r),n>r&&(n-=2*r),n},ownKeys:function(t){var e,r,n;n=[];for(e in t)__hasProp.call(t,e)&&(r=t[e],n.push(e));return n},ownVarKeys:function(t){var e,r,n;n=[];for(e in t)__hasProp.call(t,e)&&(r=t[e],this.isFunction(r)||n.push(e));return n},any:function(t){return 0!==t.length},empty:function(t){return 0===t.length},clone:function(t){return t.slice(0)},last:function(t){return this.empty(t)&&this.error("last: empty array"),t[t.length-1]},oneOf:function(t){return this.empty(t)&&this.error("oneOf: empty array"),t[this.randomInt(t.length)]},nOf:function(t,e){var r,n;for(e>t.length&&this.error("nOf: n > length"),n=[];n.length<e;)r=this.oneOf(t),__indexOf.call(n,r)<0&&n.push(r);return n},contains:function(t,e){return-1!==t.indexOf(e)},removeItem:function(t,e){var r;return-1!==(r=t.indexOf(e))&&t.splice(r,1),0>r&&this.error("removeItem: item not found"),r},shuffle:function(t){return t.sort(function(){return.5-Math.random()})},minOneOf:function(t,e,r){var n,i,o,s,a,u,h;for(null==r&&(r=!1),this.empty(t)&&this.error("minOneOf: empty array"),o=1/0,i=null,this.isString(e)&&(a=e,e=function(t){return t[a]}),u=0,h=t.length;h>u;u++)n=t[u],(s=e(n))<o&&(o=s,i=n);return r?[i,o]:i},maxOneOf:function(t,e,r){var n,i,o,s,a,u,h;for(null==r&&(r=!1),this.empty(t)&&this.error("maxOneOf: empty array"),o=-1/0,i=null,this.isString(e)&&(a=e,e=function(t){return t[a]}),u=0,h=t.length;h>u;u++)n=t[u],(s=e(n))>o&&(o=s,i=n);return r?[i,o]:i},histOf:function(t,e,r){var n,i,o,s,a,u,h,l,c,p;for(o=[],this.isString(r)&&(a=r,r=function(t){return t[a]}),h=0,c=t.length;c>h;h++)n=t[h],i=Math.floor(r(n)/e),o[i]=null!=(s=o[i])?s+1:1;for(i=l=0,p=o.length;p>l;i=++l)u=o[i],null==u&&(o[i]=0);return o},sortBy:function(t,e){return t.sort(function(t,r){return t[e]-r[e]})},uniq:function(t){var e,r,n;for(e=r=n=t.length-1;r>=1;e=r+=-1)t[e-1]===t[e]&&t.splice(e,1);return t},flatten:function(t){return t.reduce(function(t,e){return t.concat(e)})},aMax:function(t){return t.reduce(function(t,e){return Math.max(t,e)})},aMin:function(t){return t.reduce(function(t,e){return Math.min(t,e)})},aSum:function(t){return t.reduce(function(t,e){return t+e})},aMul:function(t){return t.reduce(function(t,e){return t*e})},aAvg:function(t){return this.aSum(t)/t.length},aPairwise:function(t,e,r){var n,i,o,s,a;for(i=0,a=[],n=o=0,s=t.length;s>o;n=++o)i=t[n],a.push(r(i,e[n]));return a},aPairSum:function(t,e){return this.aPairwise(t,e,function(t,e){return t+e})},aPairDif:function(t,e){return this.aPairwise(t,e,function(t,e){return t-e})},aPairMul:function(t,e){return this.aPairwise(t,e,function(t,e){return t*e})},typedToJS:function(t){var e,r,n,i;for(i=[],r=0,n=t.length;n>r;r++)e=t[r],i.push(e);return i},normalize:function(t,e){var r,n,i,o,s,a;for(null==e&&(e=.999999999),r=this.aMin(t),i=e/(this.aMax(t)-r),a=[],o=0,s=t.length;s>o;o++)n=t[o],a.push((n-r)*i);return a},binarySearch:function(t,e,r){var n,i,o,s;for(null==r&&(r=function(t){return t}),o=0,s=t.length-1,n=Math.floor((o+s)/2);(i=r(t[n]))!==e&&s>o;)i>e&&(s=n-1),e>i&&(o=n+1),n=Math.floor((s+o)/2);return r(t[n])===e?n:-1},radsToward:function(t,e,r,n){var i,o,s;return i=Math.PI,o=r-t,s=n-e,0===o?0>s?3*i/2:s>0?i/2:0:Math.atan(s/o)+(0>o?i:0)},inCone:function(t,e,r,n,i,o,s){var a;return r<this.distance(n,i,o,s)?!1:(a=this.radsToward(n,i,o,s),e/2>=Math.abs(this.subtractRads(t,a)))},distance:function(t,e,r,n){var i,o;return i=t-r,o=e-n,Math.sqrt(i*i+o*o)},sqDistance:function(t,e,r,n){var i,o;return i=t-r,o=e-n,i*i+o*o},torusDistance:function(t,e,r,n,i,o){return Math.sqrt(this.torusSqDistance(t,e,r,n,i,o))},torusSqDistance:function(t,e,r,n,i,o){var s,a,u,h;return s=Math.abs(r-t),u=Math.abs(n-e),a=Math.min(s,i-s),h=Math.min(u,o-u),a*a+h*h},torusWraps:function(t,e,r,n,i,o){var s,a;return s=Math.abs(r-t),a=Math.abs(n-e),s>i-s||a>o-a},torus4Pts:function(t,e,r,n,i,o){var s,a;return s=t>r?r+i:r-i,a=e>n?n+o:n-o,[[r,n],[s,n],[r,a],[s,a]]},torusPt:function(t,e,r,n,i,o){var s,a,u,h;return a=t>r?r+i:r-i,h=e>n?n+o:n-o,s=Math.abs(a-t)<Math.abs(r-t)?a:r,u=Math.abs(h-e)<Math.abs(n-e)?h:n,[s,u]},torusRadsToward:function(t,e,r,n,i,o){var s;return s=this.torusPt(t,e,r,n,i,o),r=s[0],n=s[1],this.radsToward(t,e,r,n)},inTorusCone:function(t,e,r,n,i,o,s,a,u){var h,l,c,p;for(p=this.torus4Pts(n,i,o,s,a,u),l=0,c=p.length;c>l;l++)if(h=p[l],this.inCone(t,e,r,n,i,h[0],h[1]))return!0;return!1},fileIndex:{},importImage:function(t,e){var r;return null!=(r=this.fileIndex[t])||(r=t).width&&r.height?null!=e&&e(r):(r=new Image,null!=e&&(r.onload=function(){return e(r)}),r.src=t,this.fileIndex[t]=r),r},xhrLoadFile:function(t,e,r){var n;return null==e&&(e="text"),null!=(n=this.fileIndex[t])?null!=r&&r(n.response):(n=new XMLHttpRequest,n.open("GET",t,null!=r),n.responseType=e,null!=r&&(n.onload=function(){return r(n.response)}),n.send(),this.fileIndex[t]=n),n},createCanvas:function(t,e){var r;return r=document.createElement("canvas"),r.width=t,r.height=e,r},createCtx:function(t,e,r){var n,i;return null==r&&(r="2d"),n=this.createCanvas(t,e),"2d"===r?n.getContext("2d"):null!=(i=n.getContext("webgl"))?i:n.getContext("experimental-webgl")},createLayer:function(t,e,r,n,i){return null==i&&(i="2d"),i=this.createCtx(e,r,i),i.canvas.setAttribute("style","position:absolute;top:0;left:0;z-index:"+n),document.getElementById(t).appendChild(i.canvas),i},setIdentity:function(t){return t.save(),t.setTransform(1,0,0,1,0,0)},clearCtx:function(t){return null!=t.save?(this.setIdentity(t),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.restore()):(t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT))},fillCtx:function(t,e){return null!=t.fillStyle?(this.setIdentity(t),t.fillStyle=this.colorStr(e),t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore()):(t.clearColor.apply(t,__slice.call(e).concat([1])),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT))},ctxDrawText:function(t,e,r,n){return null==n&&(n=[0,0,0]),t.fillStyle=this.colorStr(n),t.fillText(e,r[0],r[1])},ctxTextParams:function(t,e,r,n){return null==r&&(r="center"),null==n&&(n="middle"),t.font=e,t.textAlign=r,t.textBaseline=n},ctxLabelParams:function(t,e,r){return t.labelColor=e,t.labelXY=r},imageToCtx:function(t){var e;return e=this.createCtx(t.width,t.height),e.drawImage(t,0,0),e},ctxToImage:function(t,e){var r;return r=new Image,null!=e&&(r.onload=function(){return e(r)}),r.src=t.canvas.toDataURL("image/png")},ctxToImageData:function(t){return t.getImageData(0,0,t.canvas.width,t.canvas.height)},canvasToImage:function(t){return ctxToImage(t.getContext("2d"))},canvasToImageData:function(t){return ctxToImageData(t.getContext("2d"))},imageToCanvas:function(t){return imageToCtx(t).canvas},drawCenteredImage:function(t,e,r,n,i,o,s){return t.translate(n,i),t.rotate(r),t.drawImage(e,-o/2,-s/2)},copyCtx:function(t){var e;return e=this.createCtx(t.canvas.width,t.canvas.height),e.drawImage(t.canvas,0,0),e},resizeCtx:function(t,e,r,n){var i;return null==n&&(n=!1),i=this.copyCtx(t),t.canvas.width=e,t.canvas.height=r,t.drawImage(i.canvas,0,0)}},ABM.shapes=ABM.util.s=function(){var t,e,r,n,i,o,s;return o=function(t,e){var r,n,i,o;for(r=i=0,o=e.length;o>i;r=++i)n=e[r],0===r?t.moveTo(n[0],n[1]):t.lineTo(n[0],n[1]);return null},r=function(t,e,r,n){return t.arc(e,r,n/2,0,2*Math.PI)},t=function(t,e,r,n){return t.arc(e,r,n/2,0,2*Math.PI,!0)},e=function(t,e,r,n,i){return t.scale(1,-1),t.drawImage(i,e-n/2,r-n/2,n,n),t.scale(1,-1)},n=function(t,e,r,n){return t.fillRect(e-n/2,r-n/2,n,n)},i=function(t,e){return t.ctx.save(),t.ctx.scale(1,-1),t.ctx.drawImage(e,t.x,-(t.y+t.bits),t.bits,t.bits),t.ctx.restore()},s=[],{"default":{rotate:!0,draw:function(t){return o(t,[[.5,0],[-.5,-.5],[-.25,0],[-.5,.5]])}},triangle:{rotate:!0,draw:function(t){return o(t,[[.5,0],[-.5,-.4],[-.5,.4]])}},arrow:{rotate:!0,draw:function(t){return o(t,[[.5,0],[0,.5],[0,.2],[-.5,.2],[-.5,-.2],[0,-.2],[0,-.5]])}},bug:{rotate:!0,draw:function(t){return t.strokeStyle=t.fillStyle,t.lineWidth=.05,o(t,[[.4,.225],[.2,0],[.4,-.225]]),t.stroke(),t.beginPath(),r(t,.12,0,.26),r(t,-.05,0,.26),r(t,-.27,0,.4)}},pyramid:{rotate:!1,draw:function(t){return o(t,[[0,.5],[-.433,-.25],[.433,-.25]])}},circle:{shortcut:function(t,e,n,i){return t.beginPath(),r(t,e,n,i),t.closePath(),t.fill()},rotate:!1,draw:function(t){return r(t,0,0,1)}},square:{shortcut:function(t,e,r,i){return n(t,e,r,i)},rotate:!1,draw:function(t){return n(t,0,0,1)}},pentagon:{rotate:!1,draw:function(t){return o(t,[[0,.45],[-.45,.1],[-.3,-.45],[.3,-.45],[.45,.1]])}},ring:{rotate:!1,draw:function(e){return r(e,0,0,1),e.closePath(),t(e,0,0,.6)}},cup:{shortcut:function(t,r,n,i){return e(t,r,n,i,this.img())},rotate:!1,imgCache:null,img:function(){return this.imgCache?this.imageCache:this.imageCache=u.importImage("http://goo.gl/LTIyR")},draw:function(t){return e(t,.5,.5,1,this.img())}},person:{rotate:!1,draw:function(t){return o(t,[[.15,.2],[.3,0],[.125,-.1],[.125,.05],[.1,-.15],[.25,-.5],[.05,-.5],[0,-.25],[-.05,-.5],[-.25,-.5],[-.1,-.15],[-.125,.05],[-.125,-.1],[-.3,0],[-.15,.2]]),t.closePath(),r(t,0,.35,.3)}},names:function(){var t,e,r;r=[];for(t in this)__hasProp.call(this,t)&&(e=this[t],null!=e.rotate&&null!=e.draw&&r.push(t));return r},add:function(t,r,n,i){var o;return o=this[t]=u.isFunction(n)?{rotate:r,draw:n}:{rotate:r,img:n,draw:function(t){return e(t,.5,.5,1,this.img)}},null==o.img||o.rotate||(o.shortcut=function(t,r,n,i){return e(t,r,n,i,this.img)}),null!=i?o.shortcut=i:void 0},poly:o,circ:r,ccirc:t,cimg:e,csq:n,spriteSheets:s,draw:function(t,e,r,n,i,o,s){return null!=e.shortcut?(null==e.img&&(t.fillStyle=u.colorStr(s)),e.shortcut(t,r,n,i)):(t.save(),t.translate(r,n),1!==i&&t.scale(i,i),0!==o&&t.rotate(o),null!=e.img?e.draw(t):(t.fillStyle=u.colorStr(s),t.beginPath(),e.draw(t),t.closePath(),t.fill()),t.restore()),e},drawSprite:function(t,e,r,n,i,o){return 0===o?t.drawImage(e.ctx.canvas,e.x,e.y,e.bits,e.bits,r-i/2,n-i/2,i,i):(t.save(),t.translate(r,n),t.rotate(o),t.drawImage(e.ctx.canvas,e.x,e.y,e.bits,e.bits,-i/2,-i/2,i,i),t.restore()),e},shapeToSprite:function(t,e,r){var n,o,a,h,l,c,p,f,y;return n=Math.ceil(ABM.patches.toBits(r)),c=this[t],l=null!=c.img?t:""+t+"-"+u.colorStr(e),o=s[n],null==o&&(s[n]=o=u.createCtx(10*n,n),o.nextX=0,o.nextY=0,o.index={}),null!=(a=o.index[l])?a:(n*o.nextX===o.canvas.width&&(u.resizeCtx(o,o.canvas.width,o.canvas.height+n),o.nextX=0,o.nextY++),f=n*o.nextX,y=n*o.nextY,p={ctx:o,x:f,y:y,size:r,bits:n,name:t,color:e,index:l},o.index[l]=p,null!=(h=c.img)?0!==h.height?i(p,h):h.onload=function(){return i(p,h)}:(o.save(),o.scale(n,n),o.translate(o.nextX+.5,o.nextY+.5),o.fillStyle=u.colorStr(e),o.beginPath(),c.draw(o),o.closePath(),o.fill(),o.restore()),o.nextX++,p)}}}(),ABM.AgentSet=function(_super){function AgentSet(t,e,r){this.agentClass=t,this.name=e,this.mainSet=r,AgentSet.__super__.constructor.call(this),this.agentClass.prototype.breed=this,this.ownVariables=[],null==this.mainSet&&(this.ID=0)}return __extends(AgentSet,_super),AgentSet.asSet=function(t,e){var r;return null==e&&(e=ABM.AgentSet),t.__proto__=null!=(r=e.prototype)?r:e.constructor.prototype,t},AgentSet.prototype.create=function(){},AgentSet.prototype.add=function(t){return null!=this.mainSet?this.mainSet.add(t):t.id=this.ID++,this.push(t),t},AgentSet.prototype.remove=function(t){var e;return null!=this.mainSet&&this.mainSet.remove(t),0===this.length&&u.error("remove: empty arraySet"),t===this.last()?this[--this.length]=null:(-1!==(e=this.indexOfID(t.id))&&this.splice(e,1),-1===e&&u.error("remove: indexOfID not in list")),this},AgentSet.prototype.setDefault=function(t,e){return"string"!=typeof t&&u.error("setDefault: name is not a string"),this.agentClass.prototype[t]=e},AgentSet.prototype.own=function(){var t,e,r,n,i,o;for(r=1<=arguments.length?__slice.call(arguments,0):[],r.length%2!==0&&u.error("own: odd number of arguments"),o=[],t=n=0,i=r.length;i>n;t=n+=2)e=r[t],this.setDefault(e,r[t+1]),o.push(this.ownVariables.push(e));return o},AgentSet.prototype.uniq=function(){return u.uniq(this)},AgentSet.prototype.withID=function(t){var e;return-1!==(e=this.indexOfID(t))?this[e]:null},AgentSet.prototype.indexOfID=function(t,e){return null==e&&(e=!0),e||this.sortById(),t===this.last().id?this.length-1:u.binarySearch(this,t,function(t){return t.id})},AgentSet.prototype.asSet=function(t){return ABM.AgentSet.asSet(t)},AgentSet.prototype.asOrderedSet=function(t){return this.asSet(t).sortById()},AgentSet.prototype.toString=function(){var t;return"["+function(){var e,r,n;for(n=[],e=0,r=this.length;r>e;e++)t=this[e],n.push(t.toString());
return n}.call(this).join(", ")+"]"},AgentSet.prototype.getProp=function(t){var e,r,n,i;for(i=[],r=0,n=this.length;n>r;r++)e=this[r],i.push(e[t]);return i},AgentSet.prototype.getProps=function(t){var e,r,n,i,o;for(u.isString(t)&&(t=t.split(" ")),o=[],n=0,i=this.length;i>n;n++)e=this[n],o.push(function(){var n,i,o;for(o=[],n=0,i=t.length;i>n;n++)r=t[n],o.push(e[r]);return o}());return o},AgentSet.prototype.getPropWith=function(t,e){var r;return this.asSet(function(){var n,i,o;for(o=[],n=0,i=this.length;i>n;n++)r=this[n],r[t]===e&&o.push(r);return o}.call(this))},AgentSet.prototype.setProp=function(t,e){var r,n,i;for(n=0,i=this.length;i>n;n++)r=this[n],r[t]=e;return this},AgentSet.prototype.maxProp=function(t){return Math.max.apply(Math,this.getProp(t))},AgentSet.prototype.minProp=function(t){return Math.min.apply(Math,this.getProp(t))},AgentSet.prototype.shuffle=function(){return u.shuffle(this)},AgentSet.prototype.sortById=function(){return u.sortBy(this,"id")},AgentSet.prototype.clone=function(){return this.asSet(u.clone(this))},AgentSet.prototype.last=function(){return u.last(this)},AgentSet.prototype.any=function(){return u.any(this)},AgentSet.prototype.other=function(t){var e;return this.asSet(function(){var r,n,i;for(i=[],r=0,n=this.length;n>r;r++)e=this[r],e!==t&&i.push(e);return i}.call(this))},AgentSet.prototype.oneOf=function(){return u.oneOf(this)},AgentSet.prototype.nOf=function(t){return this.asSet(u.nOf(this,t))},AgentSet.prototype.minOneOf=function(t,e){return null==e&&(e=!1),u.minOneOf(this,t,e)},AgentSet.prototype.maxOneOf=function(t,e){return null==e&&(e=!1),u.maxOneOf(this,t,e)},AgentSet.prototype.draw=function(t){var e,r,n;for(u.clearCtx(t),r=0,n=this.length;n>r;r++)e=this[r],e.hidden||e.draw(t);return null},AgentSet.prototype.inRadius=function(t,e,r){var n,i,o,s,a,h;return null==r&&(r=!1),i=e*e,a=t.x,h=t.y,ABM.patches.isTorus?(s=ABM.patches.numX,o=ABM.patches.numY,this.asSet(function(){var e,l,c;for(c=[],e=0,l=this.length;l>e;e++)n=this[e],u.torusSqDistance(a,h,n.x,n.y,s,o)<=i&&(r||n!==t)&&c.push(n);return c}.call(this))):this.asSet(function(){var e,o,s;for(s=[],e=0,o=this.length;o>e;e++)n=this[e],u.sqDistance(a,h,n.x,n.y)<=i&&(r||n!==t)&&s.push(n);return s}.call(this))},AgentSet.prototype.inCone=function(t,e,r,n,i){var o,s,a,h,l,c;return null==i&&(i=!1),a=this.inRadius(t,n,i),l=t.x,c=t.y,ABM.patches.isTorus?(h=ABM.patches.numX,s=ABM.patches.numY,this.asSet(function(){var p,f,y;for(y=[],p=0,f=a.length;f>p;p++)o=a[p],(o===t&&i||u.inTorusCone(e,r,n,l,c,o.x,o.y,h,s))&&y.push(o);return y}())):this.asSet(function(){var s,h,p;for(p=[],s=0,h=a.length;h>s;s++)o=a[s],(o===t&&i||u.inCone(e,r,n,l,c,o.x,o.y))&&p.push(o);return p}())},AgentSet.prototype.ask=function(f){var o,_i,_len;for(u.isString(f)&&eval("f=function(o){return "+f+";}"),_i=0,_len=this.length;_len>_i;_i++)o=this[_i],f(o);return this},AgentSet.prototype["with"]=function(f){var o;return u.isString(f)&&eval("f=function(o){return "+f+";}"),this.asSet(function(){var t,e,r;for(r=[],t=0,e=this.length;e>t;t++)o=this[t],f(o)&&r.push(o);return r}.call(this))},AgentSet}(Array),ABM.Patch=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.n=null,t.prototype.n4=null,t.prototype.color=[0,0,0],t.prototype.hidden=!1,t.prototype.label=null,t.prototype.breed=null,t.prototype.toString=function(){return"{id:"+this.id+" xy:"+[this.x,this.y]+" c:"+this.color+"}"},t.prototype.scaleColor=function(t,e){return this.hasOwnProperty("color")||(this.color=u.clone(this.color)),u.scaleColor(t,e,this.color)},t.prototype.draw=function(t){return t.fillStyle=u.colorStr(this.color),t.fillRect(this.x-.5,this.y-.5,1,1),this.drawLabel(t)},t.prototype.drawLabel=function(t){var e,r,n;return null!=this.label?(n=t.labelXY,e=n[0],r=n[1],t.save(),t.translate(this.x,this.y),t.scale(1/ABM.patches.size,-1/ABM.patches.size),u.ctxDrawText(t,this.label,[e,r],t.labelColor),t.restore()):void 0},t.prototype.agentsHere=function(){var t,e;return null!=(e=this.agents)?e:function(){var e,r,n,i;for(n=ABM.agents,i=[],e=0,r=n.length;r>e;e++)t=n[e],t.p===this&&i.push(t);return i}.call(this)},t.prototype.isOnEdge=function(){return this.x===ABM.patches.minX||this.x===ABM.patches.maxX||this.y===ABM.patches.minY||this.y===ABM.patches.maxY},t.prototype.sprout=function(t,e,r){var n=this;return null==t&&(t=1),null==e&&(e=ABM.agents),null==r&&(r=function(){}),e.create(t,function(t){return t.setXY(n.x,n.y),r(t),t})},t}(),ABM.Patches=function(t){function e(){var t,r,n,i,o,s,a,u,h,l,c;e.__super__.constructor.apply(this,arguments),a=ABM.world;for(t in a)__hasProp.call(a,t)&&(r=a[t],this[t]=r);for(i=o=u=this.maxY,h=this.minY;o>=h;i=o+=-1)for(n=s=l=this.minX,c=this.maxX;c>=s;n=s+=1)this.add(new ABM.Patch(n,i));this.hasNeighbors&&this.setNeighbors(),this.setPixels(),this.drawWithPixels=1===this.size}return __extends(e,t),e.prototype.setDefaultColor=function(t){return ABM.Patch.prototype.color=t},e.prototype.cacheAgentsHere=function(){var t,e,r;for(e=0,r=this.length;r>e;e++)t=this[e],t.agents=[];return null},e.prototype.usePixels=function(t){var e;return null==t&&(t=!0),e=ABM.contexts.patches,e.imageSmoothingEnabled=!t,e.mozImageSmoothingEnabled=!t,e.webkitImageSmoothingEnabled=!t,u.setIdentity(e),this.drawWithPixels=t},e.prototype.cacheRect=function(t,e){var r,n,i,o;for(null==e&&(e=!1),o=[],n=0,i=this.length;i>n;n++)r=this[n],r.pRect=this.patchRect(r,t,t,e),r.pRect.radius=t,o.push(r.pRect.meToo=e);return o},e.prototype.setNeighbors=function(){var t,e,r,n;for(n=[],e=0,r=this.length;r>e;e++)t=this[e],t.n=this.patchRect(t,1,1),n.push(t.n4=[t.n[1],t.n[3],t.n[4],t.n[6]]);return n},e.prototype.setPixels=function(){var t;return 1===this.size?this.pixelsCtx=ABM.contexts.patches:(t=document.createElement("canvas"),t.width=this.numX,t.height=this.numY,this.pixelsCtx=t.getContext("2d")),this.pixelsImageData=this.pixelsCtx.getImageData(0,0,this.numX,this.numY),this.pixelsData=this.pixelsImageData.data,this.pixelsData instanceof Uint8Array?(this.pixelsData32=new Uint32Array(this.pixelsData.buffer),this.pixelsAreLittleEndian=u.isLittleEndian()):void 0},e.prototype.draw=function(t){return this.drawWithPixels?this.drawScaledPixels(t):e.__super__.draw.call(this,t)},e.prototype.patchIndex=function(t,e){return t-this.minX+this.numX*(this.maxY-e)},e.prototype.patchXY=function(t,e){return this[this.patchIndex(t,e)]},e.prototype.clamp=function(t,e){return[u.clamp(t,this.minX-.5,this.maxX+.5),u.clamp(e,this.minY-.5,this.maxY+.5)]},e.prototype.wrap=function(t,e){return[u.wrap(t,this.minX-.5,this.maxX+.5),u.wrap(e,this.minY-.5,this.maxY+.5)]},e.prototype.coord=function(t,e){return this.isTorus?this.wrap(t,e):this.clamp(t,e)},e.prototype.patch=function(t,e){var r;return r=this.coord(t,e),t=r[0],e=r[1],t=u.clamp(Math.round(t),this.minX,this.maxX),e=u.clamp(Math.round(e),this.minY,this.maxY),this.patchXY(t,e)},e.prototype.patchAtPixel=function(t,e){return t=Math.floor(t/this.size)+this.minX,e=this.maxY-Math.floor(e/this.size),t=u.clamp(t,this.minX,this.maxX),e=u.clamp(e,this.minY,this.maxY),this.patchXY(t,e)},e.prototype.randomPt=function(){return[u.randomFloat2(this.minX-.5,this.maxX+.5),u.randomFloat2(this.minY-.5,this.maxY+.5)]},e.prototype.toBits=function(t){return t*this.size},e.prototype.fromBits=function(t){return t/this.size},e.prototype.patchRect=function(t,e,r,n){var i,o,s,a,h,l,c,p,f,y;if(null==n&&(n=!1),null!=t.pRect&&t.pRect.radius===e)return t.pRect;for(o=[],a=h=c=t.y-r,p=t.y+r;p>=h;a=h+=1)for(s=l=f=t.x-e,y=t.x+e;y>=l;s=l+=1)this.isTorus||this.minX<=s&&s<=this.maxX&&this.minY<=a&&a<=this.maxY?(this.isTorus&&(s<this.minX&&(s+=this.numX),s>this.maxX&&(s-=this.numX),a<this.minY&&(a+=this.numY),a>this.maxY&&(a-=this.numY)),i=this.patchXY(s,a),null==i&&(u.error("patchRect: x,y out of bounds, see console.log"),console.log("x "+s+" y "+a+" p.x "+t.x+" p.y "+t.y+" dx "+e+" dy "+r))):i=null,(n||t!==i)&&o.push(i);return this.asSet(o)},e.prototype.installDrawing=function(t,e){return null==e&&(e=ABM.contexts.drawing),u.setIdentity(e),e.drawImage(t,0,0,e.canvas.width,e.canvas.height),e.restore()},e.prototype.importDrawing=function(t,e){return u.importImage(t,function(t){var r;return r=ABM.drawing,u.setIdentity(r),r.drawImage(t,0,0,r.canvas.width,r.canvas.height),r.restore(),null!=e?e():void 0})},e.prototype.pixelByteIndex=function(t){return 4*t.id},e.prototype.pixelWordIndex=function(t){return t.id},e.prototype.installColors=function(t){var e,r,n,i,o,s;for(this.pixelsCtx.drawImage(t,0,0,this.numX,this.numY),e=this.pixelsCtx.getImageData(0,0,this.numX,this.numY).data,s=[],i=0,o=this.length;o>i;i++)n=this[i],r=this.pixelByteIndex(n),s.push(n.color=[e[r++],e[r++],e[r]]);return s},e.prototype.importColors=function(t,e){var r=this;return u.importImage(t,function(t){return r.installColors(t),null!=e?e():void 0})},e.prototype.drawScaledPixels=function(t,e){return null==e&&(e=this),null!=this.pixelsData32?this.drawScaledPixels32(t,e):this.drawScaledPixels8(t,e)},e.prototype.drawScaledPixels8=function(t,e){var r,n,i,o,s,a,u,h;for(n=this.pixelsData,a=0,h=e.length;h>a;a++){for(s=e[a],i=this.pixelByteIndex(s),r=s.color,o=u=0;2>=u;o=++u)n[i+o]=r[o];n[i+3]=4===r.length?r[3]:255}return this.pixelsCtx.putImageData(this.pixelsImageData,0,0),1!==this.size?t.drawImage(this.pixelsCtx.canvas,0,0,t.canvas.width,t.canvas.height):void 0},e.prototype.drawScaledPixels32=function(t,e){var r,n,i,o,s,a,u;for(i=this.pixelsData32,a=0,u=e.length;u>a;a++)s=e[a],o=this.pixelWordIndex(s),n=s.color,r=4===n.length?n[3]:255,i[o]=this.pixelsAreLittleEndian?r<<24|n[2]<<16|n[1]<<8|n[0]:n[0]<<24|n[1]<<16|n[2]<<8|r;return this.pixelsCtx.putImageData(this.pixelsImageData,0,0),1!==this.size?t.drawImage(this.pixelsCtx.canvas,0,0,t.canvas.width,t.canvas.height):void 0},e.prototype.diffuse=function(t,e,r){var n,i,o,s,a,u,h,l,c,p,f,y,d,g;if(null==this[0]._diffuseNext)for(u=0,p=this.length;p>u;u++)a=this[u],a._diffuseNext=0;for(h=0,f=this.length;f>h;h++)for(a=this[h],n=a[t]*e,i=n/8,s=a.n.length,a._diffuseNext+=a[t]-n+(8-s)*i,g=a.n,l=0,y=g.length;y>l;l++)o=g[l],o._diffuseNext+=i;for(c=0,d=this.length;d>c;c++)a=this[c],a[t]=a._diffuseNext,a._diffuseNext=0,r&&a.scaleColor(r,a[t]);return null},e}(ABM.AgentSet),ABM.Agent=function(){function t(){this.x=this.y=0,null==this.color&&(this.color=u.randomColor()),null==this.heading&&(this.heading=u.randomFloat(2*Math.PI)),this.p=ABM.patches.patch(this.x,this.y),null!=this.p.agents&&this.p.agents.push(this),this.cacheLinks&&(this.links=[])}return t.prototype.color=null,t.prototype.shape="default",t.prototype.breed=null,t.prototype.hidden=!1,t.prototype.size=1,t.prototype.penDown=!1,t.prototype.penSize=1,t.prototype.heading=null,t.prototype.sprite=null,t.prototype.cacheLinks=!1,t.prototype.changeBreed=function(t){var e=this;return null==this.id&&u.error("changeBreed: not in agentSet"),this.hasOwnProperty("breed")&&u.error("changeBreed: breed illegally set"),this.breed===t&&u.error("changeBreed: breed==newBreed"),this.die(),t.create(1,function(t){return t.setXY(e.x,e.y)})},t.prototype.scaleColor=function(t,e){return this.hasOwnProperty("color")||(this.color=u.clone(this.color)),u.scaleColor(t,e,this.color)},t.prototype.toString=function(){return"{id:"+this.id+" xy:"+u.aToFixed([this.x,this.y])+" c:"+this.color+" h: "+this.heading.toFixed(2)+"}"},t.prototype.setXY=function(t,e){var r,n,i,o,s,a;return this.penDown&&(s=[this.x,this.y],i=s[0],o=s[1]),a=ABM.patches.coord(t,e),this.x=a[0],this.y=a[1],n=this.p,this.p=ABM.patches.patch(this.x,this.y),null!=n.agents&&n!==this.p&&(u.removeItem(n.agents,this),this.p.agents.push(this)),this.penDown?(r=ABM.drawing,r.strokeStyle=u.colorStr(this.color),r.lineWidth=ABM.patches.fromBits(this.penSize),r.beginPath(),r.moveTo(i,o),r.lineTo(t,e),r.stroke()):void 0},t.prototype.moveTo=function(t){return this.setXY(t.x,t.y)},t.prototype.forward=function(t){return this.setXY(this.x+t*Math.cos(this.heading),this.y+t*Math.sin(this.heading))},t.prototype.rotate=function(t){return this.heading=u.wrap(this.heading+t,0,2*Math.PI)},t.prototype.draw=function(t){var e,r;return r=ABM.shapes[this.shape],e=r.rotate?this.heading:0,null!=this.sprite||this.breed.useSprites?(null==this.sprite&&this.setSprite(),ABM.shapes.drawSprite(t,this.sprite,this.x,this.y,this.size,e)):ABM.shapes.draw(t,r,this.x,this.y,this.size,e,this.color)},t.prototype.setSprite=function(t){var e;return null!=(e=t)?(this.sprite=e,this.color=e.color,this.shape=e.shape,this.size=e.size):(null==this.color&&(this.color=u.randomColor),this.sprite=ABM.shapes.shapeToSprite(this.shape,this.color,this.size))},t.prototype.stamp=function(){return this.draw(ABM.drawing)},t.prototype.distanceXY=function(t,e){return ABM.patches.isTorus?u.torusDistance(this.x,this.y,t,e,ABM.patches.numX,ABM.patches.numY):u.distance(this.x,this.y,t,e)},t.prototype.distance=function(t){return this.distanceXY(t.x,t.y)},t.prototype.torusPtXY=function(t,e){return u.torusPt(this.x,this.y,t,e,ABM.patches.numX,ABM.patches.numY)},t.prototype.torusPt=function(t){return this.torusPtXY(t.x,t.y)},t.prototype.face=function(t){return this.heading=this.towards(t)},t.prototype.towardsXY=function(t,e){return ABM.patches.isTorus?u.torusRadsToward(this.x,this.y,t,e,ABM.patches.numX,ABM.patches.numY):u.radsToward(this.x,this.y,t,e)},t.prototype.towards=function(t){return this.towardsXY(t.x,t.y)},t.prototype.die=function(){var t,e,r,n;for(this.breed.remove(this),n=this.myLinks(),e=0,r=n.length;r>e;e++)t=n[e],t.die();return null!=this.p.agents&&u.removeItem(this.p.agents,this),null},t.prototype.hatch=function(t,e,r){var n=this;return null==t&&(t=1),null==e&&(e=ABM.agents),null==r&&(r=function(){}),e.create(t,function(t){var e,i;t.setXY(n.x,n.y);for(e in n)__hasProp.call(n,e)&&(i=n[e],"id"!==e&&(t[e]=i));return r(t),t})},t.prototype.inCone=function(t,e,r,n){return null==n&&(n=!1),t.inCone(this.p,this.heading,e,r,n)},t.prototype.otherEnd=function(t){return t.end1===this?t.end2:t.end1},t.prototype.myLinks=function(){var t,e;return null!=(e=this.links)?e:function(){var e,r,n,i;for(n=ABM.links,i=[],e=0,r=n.length;r>e;e++)t=n[e],(t.end1===this||t.end2===this)&&i.push(t);return i}.call(this)},t.prototype.linkNeighbors=function(){var t,e,r,n,i;for(n=this.myLinks(),i=[],e=0,r=n.length;r>e;e++)t=n[e],i.push(this.otherEnd(t));return i},t.prototype.myInLinks=function(){var t,e,r,n,i;for(n=this.myLinks(),i=[],e=0,r=n.length;r>e;e++)t=n[e],t.end2===this&&i.push(t);return i},t.prototype.inLinkNeighbors=function(){var t,e,r,n,i;for(n=this.myLinks(),i=[],e=0,r=n.length;r>e;e++)t=n[e],t.end2===this&&i.push(t.end1);return i},t.prototype.myOutLinks=function(){var t,e,r,n,i;for(n=this.myLinks(),i=[],e=0,r=n.length;r>e;e++)t=n[e],t.end1===this&&i.push(t);return i},t.prototype.outLinkNeighbors=function(){var t,e,r,n,i;for(n=this.myLinks(),i=[],e=0,r=n.length;r>e;e++)t=n[e],t.end1===this&&i.push(t.end2);return i},t}(),ABM.Agents=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.useSprites=!1}return __extends(e,t),e.prototype.cacheLinks=function(){return ABM.Agent.prototype.cacheLinks=!0},e.prototype.setDefaultColor=function(t){return this.agentClass.prototype.color=t},e.prototype.setDefaultShape=function(t){return this.agentClass.prototype.shape=t},e.prototype.setDefaultSize=function(t){return this.agentClass.prototype.size=t},e.prototype.setDefaultHeading=function(t){return this.agentClass.prototype.heading=t},e.prototype.setDefaultHidden=function(t){return this.agentClass.prototype.hidden=t},e.prototype.setDefaultSprite=function(t){return this.setDefaultColor(t.color),this.setDefaultShape(t.shape),this.setDefaultSize(t.size),this.agentClass.prototype.sprite=t},e.prototype.setDefaultPen=function(t,e){return null==e&&(e=!1),this.agentClass.prototype.penSize=t,this.agentClass.prototype.penDown=e},e.prototype.setUseSprites=function(t){this.useSprites=null!=t?t:!0},e.prototype["in"]=function(t){var e;return this.asSet(function(){var r,n,i;for(i=[],r=0,n=t.length;n>r;r++)e=t[r],e.breed===this&&i.push(e);return i}.call(this))},e.prototype.create=function(t,e){var r,n,i;for(null==e&&(e=function(){}),i=[],r=n=1;t>=n;r=n+=1)i.push(function(t){return e(t),t}(this.add(new this.agentClass)));return i},e.prototype.clear=function(){for(;this.any();)this.last().die();return null},e.prototype.inPatches=function(t){var e,r,n,i;for(e=[],n=0,i=t.length;i>n;n++)r=t[n],e.push.apply(e,r.agentsHere());return null!=this.mainSet?this["in"](e):this.asSet(e)},e.prototype.inRect=function(t,e,r,n){var i;return null==n&&(n=!1),i=ABM.patches.patchRect(t.p,e,r,!0),i=this.inPatches(i),n||u.removeItem(i,t),i},e.prototype.inCone=function(t,e,r,n,i){var o;return null==i&&(i=!1),o=this.inRect(t,n,n,!0),o.inCone(t,e,r,n,i)},e.prototype.inRadius=function(t,e,r){var n;return null==r&&(r=!1),n=this.inRect(t,e,e,!0),n.inRadius(t,e,r)},e}(ABM.AgentSet),ABM.Link=function(){function t(t,e){this.end1=t,this.end2=e,null!=this.end1.links&&(this.end1.links.push(this),this.end2.links.push(this))}return t.prototype.breed=null,t.prototype.color=[130,130,130],t.prototype.thickness=2,t.prototype.hidden=!1,t.prototype.draw=function(t){var e;return t.save(),t.strokeStyle=u.colorStr(this.color),t.lineWidth=ABM.patches.fromBits(this.thickness),t.beginPath(),ABM.patches.isTorus?(e=this.end1.torusPt(this.end2),t.moveTo(this.end1.x,this.end1.y),t.lineTo.apply(t,e),(e[0]!==this.end2.x||e[1]!==this.end2.y)&&(e=this.end2.torusPt(this.end1),t.moveTo(this.end2.x,this.end2.y),t.lineTo.apply(t,e))):(t.moveTo(this.end1.x,this.end1.y),t.lineTo(this.end2.x,this.end2.y)),t.closePath(),t.stroke(),t.restore()},t.prototype.die=function(){return this.breed.remove(this),null!=this.end1.links&&u.removeItem(this.end1.links,this),null!=this.end2.links&&u.removeItem(this.end2.links,this),null},t.prototype.bothEnds=function(){return[this.end1,this.end2]},t.prototype.length=function(){return this.end1.distance(this.end2)},t.prototype.otherEnd=function(t){return this.end1===t?this.end2:this.end1},t}(),ABM.Links=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.setDefaultColor=function(t){return this.agentClass.prototype.color=t},e.prototype.setDefaultThickness=function(t){return this.agentClass.prototype.thickness=t},e.prototype.setDefaultHidden=function(t){return this.agentClass.prototype.hidden=t},e.prototype.create=function(t,e,r){var n,i,o,s;for(null==r&&(r=function(){}),null==e.length&&(e=[e]),s=[],i=0,o=e.length;o>i;i++)n=e[i],s.push(function(t){return r(t),t}(this.add(new this.agentClass(t,n))));return s},e.prototype.clear=function(){for(;this.any();)this.last().die();return null},e.prototype.allEnds=function(){var t,e,r,n;for(e=this.asSet([]),r=0,n=this.length;n>r;r++)t=this[r],e.push(t.end1,t.end2);return e},e.prototype.nodes=function(){return this.allEnds().sortById().uniq()},e.prototype.layoutCircle=function(t,e,r,n){var i,o,s,a,u;for(null==r&&(r=Math.PI/2),null==n&&(n=-1),o=2*Math.PI/t.length,s=a=0,u=t.length;u>a;s=++a)i=t[s],i.setXY(0,0),i.heading=r+n*o*s,i.forward(e);return null},e}(ABM.AgentSet),ABM.Animator=function(){function t(t,e,r,n){this.model=t,this.rate=null!=e?e:30,this.multiStep=null!=r?r:!1,this.drawRate=null!=n?n:30,this.animateDraws=__bind(this.animateDraws,this),this.animateSteps=__bind(this.animateSteps,this),this.reset()}return t.prototype.setRate=function(t,e){return this.multiStep=null!=e?e:!1,this.drawRate===this.rate&&(this.drawRate=t),this.rate=t,this.resetAnim()},t.prototype.setDrawRate=function(t){return this.drawRate=t,this.resetAnim()},t.prototype.start=function(){return this.animStop?(this.resetAnim(),this.animStop=!1,this.animate()):void 0},t.prototype.resetAnim=function(){return this.startMS=this.now(),this.startTick=this.ticks,this.startDraw=this.draws},t.prototype.stop=function(){return this.animStop=!0,null!=this.animHandle&&cancelAnimFrame(this.animHandle),null!=this.timeoutHandle&&clearTimeout(this.timeoutHandle),null!=this.intervalHandle&&clearInterval(this.intervalHandle),this.animHandle=this.timerHandle=this.intervalHandle=null},t.prototype.reset=function(){return this.stop(),this.ticks=this.draws=0},t.prototype.step=function(){return this.ticks++,this.model.step()},t.prototype.drawInProgress=!1,t.prototype.draw=function(){var t=this;return this.drawInProgress?!1:(this.drawInProgress=!0,setTimeout(function(){return t.draws++,t.model.draw(),t.drawInProgress=!1},1),!0)},t.prototype.once=function(){return this.step(),this.draw()},t.prototype.now=function(){return null!=("undefined"!=typeof performance&&null!==performance?performance.now:void 0)?performance.now():Date.now()},t.prototype.ms=function(){return this.now()-this.startMS},t.prototype.ticksPerSec=function(){var t;return 0===(t=this.ticks-this.startTick)?0:Math.round(1e3*t/this.ms())},t.prototype.drawsPerSec=function(){var t;return 0===(t=this.draws-this.startDraw)?0:Math.round(1e3*t/this.ms())},t.prototype.toString=function(){return"ticks: "+this.ticks+", draws: "+this.draws+", rate: "+this.rate+"/"+this.drawRate+" "+this.ticksPerSec()+"/"+this.drawsPerSec()},t.prototype.animateSteps=function(){return this.step(),this.animStop?void 0:this.timeoutHandle=setTimeout(this.animateSteps,1e3/this.rate)},t.prototype.animateDraws=function(){return!this.multiStep&&this.ticksPerSec()<=this.rate&&this.step(),this.drawsPerSec()<=this.drawRate&&this.draw(),this.animStop?void 0:this.animHandle=requestAnimFrame(this.animateDraws)},t.prototype.animate=function(){return this.multiStep&&this.animateSteps(),this.animateDraws()},t}(),ABM.Model=function(){function t(t,e,r,n,i,o,s,a){var u,h,l;this.div=t,null==s&&(s=!0),null==a&&(a=!0),ABM.model=this,this.setWorld(e,r,n,i,o,s,a),this.contexts=ABM.contexts={},l=this.contextsInit;for(u in l)__hasProp.call(l,u)&&(h=l[u],this.addContext(u,h.z,h.ctx));this.drawing=ABM.drawing=this.contexts.drawing,this.contexts.spotlight.globalCompositeOperation="xor",this.anim=new ABM.Animator(this),this.refreshLinks=this.refreshAgents=this.refreshPatches=!0,this.patches=ABM.patches=new ABM.Patches(ABM.Patch,"patches"),this.agents=ABM.agents=new ABM.Agents(ABM.Agent,"agents"),this.links=ABM.links=new ABM.Links(ABM.Link,"links"),this.setup()}return t.prototype.contextsInit={patches:{z:0,ctx:"2d"},drawing:{z:1,ctx:"2d"},links:{z:2,ctx:"2d"},agents:{z:3,ctx:"2d"},spotlight:{z:4,ctx:"2d"}},t.prototype.addContext=function(t,e,r){return null==r&&(r="2d"),this.contexts[t]=r=u.createLayer(this.div,this.world.width,this.world.height,e,r),this.setCtxTransform(r),r},t.prototype.reset=function(){var t,e,r;this.anim.reset(),this.patches=ABM.patches=new ABM.Patches(ABM.Patch,"patches"),this.agents=ABM.agents=new ABM.Agents(ABM.Agent,"agents"),this.links=ABM.links=new ABM.Links(ABM.Link,"links"),r=this.contexts;for(t in r)e=r[t],this.setCtxTransform(e);return this.setSpotlight(null),this.contexts.spotlight.globalCompositeOperation="xor",u.s.spriteSheets.length=0},t.prototype.restart=function(){return this.reset(),this.setup(),this.start()},t.prototype.setWorld=function(t,e,r,n,i,o,s){var a,u,h,l;return null==o&&(o=!0),null==s&&(s=!0),u=r-e+1,h=i-n+1,l=u*t,a=h*t,ABM.world=this.world={size:t,minX:e,maxX:r,minY:n,maxY:i,numX:u,numY:h,width:l,height:a,isTorus:o,hasNeighbors:s}},t.prototype.setCtxTransform=function(t){return t.canvas.width=this.world.width,t.canvas.height=this.world.height,t.save(),t.scale(this.world.size,-this.world.size),t.translate(-(this.world.minX-.5),-(this.world.maxY+.5)),t.msImageSmoothingEnabled=!1},t.prototype.setFastPatches=function(){return this.patches.usePixels()},t.prototype.setCacheAgentsHere=function(){return this.patches.cacheAgentsHere()},t.prototype.setCacheMyLinks=function(){return this.agents.cacheLinks()},t.prototype.setCachePatchRects=function(t,e){return null==e&&(e=!1),this.patches.cacheRect(t,e)},t.prototype.setTextParams=function(t,e,r,n){return null==r&&(r="center"),null==n&&(n="middle"),u.ctxTextParams(this.contexts[t.name],e,r,n)},t.prototype.setLabelParams=function(t,e,r){return u.ctxLabelParams(this.contexts[t.name],e,r)},t.prototype.setup=function(){},t.prototype.step=function(){},t.prototype.start=function(){return this.anim.start()},t.prototype.stop=function(){return this.anim.stop()},t.prototype.once=function(){return this.anim.once()},t.prototype.draw=function(){return(this.refreshPatches||1===this.anim.draws)&&this.patches.draw(this.contexts.patches),(this.refreshLinks||1===this.anim.draws)&&this.links.draw(this.contexts.links),(this.refreshAgents||1===this.anim.draws)&&this.agents.draw(this.contexts.agents),null!=this.spotlightAgent?this.drawSpotlight(this.spotlightAgent,this.contexts.spotlight):void 0},t.prototype.setSpotlight=function(t){return this.spotlightAgent=t,null==this.spotlightAgent?u.clearCtx(this.contexts.spotlight):void 0},t.prototype.drawSpotlight=function(t,e){return u.clearCtx(e),u.fillCtx(e,[0,0,0,.6]),e.beginPath(),e.arc(t.x,t.y,this.spotlightRadius||3,0,2*Math.PI,!1),e.fill()},t.prototype.createBreeds=function(t,e,r){var n,i,o,s,a,u,h,l;for(o=[],o.classes={},o.sets={},h=t.split(" "),a=0,u=h.length;u>a;a++)i=h[a],s=n=function(t){function e(){return l=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e}(e),this[i]=new r(s,i,e.prototype.breed),o.push(this[i]),o.sets[i]=this[i],o.classes[""+i+"Class"]=s;return o},t.prototype.patchBreeds=function(t){return ABM.patchBreeds=this.createBreeds(t,ABM.Patch,ABM.Patches)},t.prototype.agentBreeds=function(t){return ABM.agentBreeds=this.createBreeds(t,ABM.Agent,ABM.Agents)},t.prototype.linkBreeds=function(t){return ABM.linkBreeds=this.createBreeds(t,ABM.Link,ABM.Links)},t.prototype.asSet=function(t){return ABM.AgentSet.asSet(t)},t.prototype.setRootVars=function(){return root.ps=this.patches,root.p0=this.patches[0],root.as=this.agents,root.a0=this.agents[0],root.ls=this.links,root.l0=this.links[0],root.dr=this.drawing,root.u=ABM.util,root.sh=ABM.shapes,root.app=this,root.cx=this.contexts,root.ab=ABM.agentBreeds,root.lb=ABM.linkBreeds,root.an=this.anim,root.wd=ABM.world,root.gl=this.globals,root.root=root,null},t}()}.call(this);